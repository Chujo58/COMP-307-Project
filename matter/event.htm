<div class="popup" id="popup">
    <img src="icons/pulsar_line_close.png" id="close" onclick="closePopup();">
</div>
<div class="event-column-holder">
    <div id="event-informations" class="event-columns-box" style="width: 65%;">
        <div id="event-body" class="event-body">

        </div>
        <div id="event-calendar-holder">
            <div class="calendar-body" id="calendar-in-event">
                <div class="calendar-holder" id="topbar">
                    <a onclick="toggleSidebar();" id="sidebar-menu">
                        <img src="icons/pulsar_line_close.svg">
                    </a>
                    <div id="calendar-page-icon">
            
                    </div>
                    <a onclick="toToday();">
                        Today
                    </a>
                    <div class="icons" id="week_btns">
                        <span id="prev_week"
                            class="material-symbols-rounded">chevron_left</span>
                        <span id="next_week"
                            class="material-symbols-rounded">chevron_right</span>
                    </div>
                    <p class="current-month calendar-heading-highlight"
                        id="current-week"></p>
                    <a style="margin-left: auto;" onclick="toggleView();"
                        id="view-selector">
                        Week
                    </a>
                </div>
                <div class="add-event" id="add_event_btn" style="display: none;" onclick="document.getElementById('calendar-popup').className += ' active';">
                    <span>
                        <img src="icons/pulsar_line_add.png">
                    </span>
                    <div class="add-event-text">
                        Create
                    </div>
                </div>
                <div class="calendar-holder" id="botbar">
                    <div class="calendar-sidebar" id="sidebar">
                        <div class="add-event hidden" id="calendar-add-placeholder"></div>
                        <div class="wrapper">
                            <header class="calendar-header">
                                <p class="current-month calendar-heading-highlight"
                                    id="current-month"></p>
                                <div class="icons">
                                    <span id="prev"
                                        class="material-symbols-rounded">chevron_left</span>
                                    <span id="next"
                                        class="material-symbols-rounded">chevron_right</span>
                                </div>
                            </header>
                            <div class="calendar">
                                <ul class="weekday">
                                    <li>Sun</li>
                                    <li>Mon</li>
                                    <li>Tue</li>
                                    <li>Wed</li>
                                    <li>Thu</li>
                                    <li>Fri</li>
                                    <li>Sat</li>
                                </ul>
                                <ul class="days" id="days"></ul>
                            </div>
                        </div>
                        <div>
                            <div class="filters-holder">
                                <span>
                                    <img src="icons/pulsar_color_calendar.png">
                                </span>
                                <div class="calendar-heading-highlight" id="filters-header">
                                    Calendars
                                </div>
                            </div>
                                <div id="filters"></div>
                        </div>
                    </div>
                    <div class="calendar-popup" id="calendar-popup">
                        <img src="icons/pulsar_line_close.png" onclick="document.getElementById('calendar-popup').className='calendar-popup';">
                        <form id="calendar-create-form" action="php/calendar.php" method="post">
                            <div class="heading-highlight form-heading">
                                Create availability
                            </div>
                            <input type="text" name="event_name" id="event_name" placeholder="Event Name" onfocusout="isFieldEmpty('event_name')">
                            <div></div>
                            <input type="datetime-local" name="event_start" id="event_start" onfocusout="isFieldEmpty('event_start')">
                            <div></div>
                            <input type="datetime-local" name="event_stop" id="event_stop" onfocusout="isFieldEmpty('event_stop')">
                            <div></div>
                            <input type="text" name="event_desc" id="event_desc" placeholder="Description" onfocusout="isFieldEmpty('event_desc')">
                            <div></div>
                            <input type="text" name="event_filter" id="event_filter" placeholder="Course Name" onfocusout="isFieldEmpty('event_filter')">
                            <div></div>
                            <input type="button" value="Create" style="cursor: pointer;" onclick="addEvent();">
                        </form>
                    </div>
                    <div class="calendar" id="weekly-calendar">
                        <ul class="weekday" id="weekly-calendar-label"></ul>
                        <ul class="days" id="weekly-days"></ul>
                        <div class="timetable-wrapper">
                            <div class="timetable" id="timetable">
                                <div class="times" id="timestamps" aria-hidden="true"
                                    tabindex="-1"></div>
                                <div id="time-sep"></div>
                                <div class="time-row" id="time-row" role="row"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="event-columns-box" style="width: 35%;">
        <form action="php/calendar.php" method="post" id="booking-form" style="display: none;">
            <div class="heading-highlight form-heading">
                Create booking
            </div>
            <div id="event-booking-message"></div>
            <input type="text" name="event_name" id="event_name_book" placeholder="Event Name" onfocusout="isFieldEmpty('event_name')">
            <div></div>
            <div class="form-label">Event Start Date</div>
            <input type="datetime-local" name="event_start" id="event_start_book" onfocusout="isFieldEmpty('event_start')">
            <div></div>
            <div class="form-label">Event Stop Date</div>
            <input type="datetime-local" name="event_stop" id="event_stop_book" onfocusout="isFieldEmpty('event_stop')">
            <div></div>
            <input type="text" name="event_desc" id="event_desc_book" placeholder="Description" onfocusout="isFieldEmpty('event_desc')">
            <div></div>
            <input type="text" name="event_filter" id="event_filter_book" placeholder="Course Name" onfocusout="isFieldEmpty('event_filter')">
            <div></div>

            <input type="text" class="hidden-form" name="fname" id="fname_book" placeholder="First Name" onfocusout="isFieldEmpty('fname')">
            <div></div>
            <input type="text" class="hidden-form" name="lname" id="lname_book" placeholder="Last Name" onfocusout="isFieldEmpty('lname')">
            <div></div>
            <input type="email" class="hidden-form" name="email" id="email_book" placeholder="Email" onfocusout="isFieldEmpty('email')">
            <div></div>

            <input type="button" value="Create" style="cursor: pointer;" onclick="createBooking();">
        </form>
    </div>
</div>

<script>
    // Fetch event details from the server
    function fetchEventDetails(eventID) {
        const xhr = new XMLHttpRequest();
        xhr.open('GET', `php/show_event_details.php?event_id=${eventID}`, true);
        xhr.onreadystatechange = function() {
            if (xhr.readyState === 4 && xhr.status === 200) {
                const response = xhr.responseText.trim().split(',');
                const eventType = response[4] ?? ''; // Event type is at index 4 in CSV
                if (eventType === 'availability') {
                    // Show the form if event type is 'availability'
                    document.getElementById('booking-form').style.display = 'block';
                }
            }
        };
        xhr.send();
    }

    // Get event_id from URL and fetch event details
    const eventID = new URLSearchParams(window.location.search).get('event_id');
    if (eventID) {
        fetchEventDetails(eventID);
    }
</script>